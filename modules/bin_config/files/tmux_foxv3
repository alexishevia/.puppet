#!/bin/bash

# if 'foxv3' session exists, attach to it.
# otherwise, create it with the following windows:
# - fbccontent: vim
# - dcgmodels-v3: vim
# - docker: start docker-compose

tmux has-session -t foxv3

if [ $? != 0 ]
then
    # fbccontent window
    tmux new -s foxv3 -n fbccontent -d
    tmux send-keys -t foxv3:fbccontent 'cd ~/Projects/X-Team/v3/brian-hub' C-m
    tmux send-keys -t foxv3:fbccontent 'nvm use' C-m
    tmux send-keys -t foxv3:fbccontent 'clear' C-m
    tmux send-keys -t foxv3:fbccontent 'git pull' C-m
    tmux send-keys -t foxv3:fbccontent 'git submodule update --recursive --remote' C-m

    # dcgmodels-v3 window
    tmux new-window -t foxv3 -n dcgmodels-v3
    tmux send-keys -t foxv3:dcgmodels-v3 'cd ~/Projects/X-Team/v3/brian-hub/dcgmodels-v3' C-m
    tmux send-keys -t foxv3:dcgmodels-v3 'nvm use' C-m
    tmux send-keys -t foxv3:dcgmodels-v3 'clear' C-m
    tmux send-keys -t foxv3:dcgmodels-v3 'vim .'

    # docker window
    tmux new-window -t foxv3 -n docker
    tmux send-keys -t foxv3:docker 'cd ~/Projects/X-Team/v3/brian-hub' C-m
    tmux send-keys -t foxv3:docker 'nvm use' C-m
    tmux send-keys -t foxv3:docker 'clear' C-m
    tmux send-keys -t foxv3:docker 'COMPOSE_HTTP_TIMEOUT=300 docker-compose up'
fi

# select window 'fbccontent'
tmux select-window -t foxv3:fbccontent

# attach to session
tmux attach -t foxv3
